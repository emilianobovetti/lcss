#!/bin/bash

. "$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)/../mk-env" --

strings=$(cat <<EOF
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataaccatgaggatgttacatggtcgcccattgctgccggatttaagaggctgatccccgaaaaagtaaaatcacgtccacagtgttgtgacgatgacgcgatgattatatgcgggtgtatggctcgccttaacaggaacaacagcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgctggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataaccatgaggatgttacatggtcgcccattgctgccggatttaagaggctgatccccgaaaaagtaaaatcacgtccacagtgttgtgacgatgacgcgatgattatatgcgggtgtatggctcgccttaacaggaacaacagcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgctggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggtgcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagaggctgatccccgaaaaagtaaaatcacgtccacagtgttgtgacgatgacgcgatgattatatgcgggtgtatggctcgccttaacaggaacaacagcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgctggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagtgctggggggcatgggcggcaaataaccatgaggatgtgacctggtcacccattgccgccggatttaagggactgatccccgaaaaagtaaaatcacgcccgcagtgctgtgacgatgatgcgatggtgatatgcgggtgtatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgctggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagggactgatccccgaaaaagtaaaatcacgtccacagtgctgtgacgatgatgcgatggtgatatgcgggtgcatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgttggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagggactgatccccgaaaaagtaaaatcacgtccacagtgctgtgacgatgatgcgatggtgatatgcgggtgcatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgttggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagggactgatccccgaaaaagtaaaatcacgtccacagtgctgtgacgatgatgcgatggtgatatgcgggtgcatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgttggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagggactgatccccgaaaaagtaaaatcacgtccacagtgctgtgacgatgatgcgatggtgatatgcgggtgcatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgttggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagggactgatccccgaaaaagtaaaatcacgtccacagtgctgtgacgatgatgcgatggtgatatgcgggtgcatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgttggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagtgctggggggcatgggcggcaaataaccatgaggatgtgacctggtcacccattgccgccggatttaagggactgatccccgaaaaagtaaaatcacgcccgcagtgctgtgacgatgatgcgatggtgatatgcgggtgtatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgctggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagggactgatccccgaaaaagtaaaatcacgtccacagtgctgtgacgatgatgcgatggtgatatgcgggtgcatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgttggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataaccatgaggatgttacatggtcgcccattgctgccggatttaagaggctgatccccgaaaaagtaaaatcacgtccacagtgttgtgacgatgacgcgatgattatatgcgggtgtatggctcgccttaacaggaacaacagcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgctggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataaccatgaggatgttacatggtcgcccattgctgccggatttaagaggctgatccccgaaaaagtaaaatcacgtccacagtgttgtgacgatgacgcgatgattatatgcgggtgtatggctcgccttaacaggaacaacagcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgctggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataaccatgaggatgttacatggtcgcccattgctgccggatttaagaggctgatccccgaaaaagtaaaatcacgtccacagtgttgtgacgatgacgcgatgattatatgcgggtgtatggctcgccttaacaggaacaacagcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgctggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataaccatgaggatgttacatggtcgcccattgctgccggatttaagaggctgatccccgaaaaagtaaaatcacgtccacagtgttgtgacgatgacgcgatgattatatgcgggtgtatggctcgccttaacaggaacaacagcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgctggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataaccatgaggatgttacatggtcgcccattgctgccggatttaagaggctgatccccgaaaaagtaaaatcacgtccacagtgttgtgacgatgacgcgatgattatatgcgggtgtatggctcgccttaacaggaacaacagcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgctggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataaccatgaggatgttacatggtcgcccattgctgccggatttaagaggctgatccccgaaaaagtaaaatcacgtccacagtgttgtgacgatgacgcgatgattatatgcgggtgtatggctcgccttaacaggaacaacagcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgctggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagggactgatccccgaaaaagtaaaatcacgtccacagtgctgtgacgatgatgcgatggtgatatgcgggtgcatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgttggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagggactgatccccgaaaaagtaaaatcacgtccacagtgctgtgacgatgatgcgatggtgatatgcgggtgcatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgttggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagggactgatccccgaaaaagtaaaatcacgtccacagtgctgtgacgatgatgcgatggtgatatgcgggtgcatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgttggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagggactgatccccgaaaaagtaaaatcacgtccacagtgctgtgacgatgatgcgatggtgatatgcgggtgcatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgttggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagtgctggggggcatgggcggcaaataaccatgaggatgtgacctggtcacccattgccgccggatttaagggactgatccccgaaaaagtaaaatcacgcccgcagtgctgtgacgatgatgcgatggtgatatgcgggtgtatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgctggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagggactgatccccgaaaaagtaaaatcacgtccacagtgctgtgacgatgatgcgatggtgatatgcgggtgcatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgttggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagggactgatccccgaaaaagtaaaatcacgtccacagtgctgtgacgatgatgcgatggtgatatgcgggtgcatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgttggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagtgctggggggcatgggcggcaaataaccatgaggatgtgacctggtcacccattgccgccggatttaagggactgatccccgaaaaagtaaaatcacgcccgcagtgctgtgacgatgatgcgatggtgatatgcgggtgtatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgctggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataaccatgaggatgttacatggtcgcccattgctgccggatttaagaggctgatccccgaaaaagtaaaatcacgtccacagtgttgtgacgatgacgcgatgattatatgcgggtgtatggctcgccttaacaggaacaacagcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgctggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagggactgatccccgaaaaagtaaaatcacgtccacagtgctgtgacgatgatgcgatggtgatatgcgggtgcatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgttggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataaccatgaggatgttacatggtcgcccattgctgccggatttaagaggctgatccccgaaaaagtaaaatcacgtccacagtgttgtgacgatgacgcgatgattatatgcgggtgtatggctcgccttaacaggaacaacagcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgctggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagggactgatccccgaaaaagtaaaatcacgtccacagtgctgtgacgatgatgcgatggtgatatgcgggtgcatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgttggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagggactgatccccgaaaaagtaaaatcacgtccacagtgctgtgacgatgatgcgatggtgatatgcgggtgcatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgttggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
tgatgcgtgatatccggcaggttcttgagcgctggggggcatgggcggcaaataactatgaggatgttacatggtcgcccattgctgccggatttaagggactgatccccgaaaaagtaaaatcacgtccacagtgctgtgacgatgatgcgatggtgatatgcgggtgcatagcccgcctttaccggaacaatcgcgatctgcatgacttgctggttgattattacgtgttgggggagacgttcatggcgttggcacggaaacatgggtgctctgacacctgtataggtaaacgccttca
EOF
)

str_num="$(echo "$strings" | wc -l)"

regex="$(time (echo "$strings" | "$UTILS_DIR/regex-compiler"))"
match_count="$(echo "$strings" | grep -c -E -- "^$regex")"

if [ "$match_count" -eq "$str_num" ]; then
    echo "regex '$regex' succesfully matched $str_num strings"
else
    echo "regex '$regex' matched only $match_count strings on $str_num" 1>&2
    exit 1
fi
